"use strict";var sharp=require("sharp"),potrace=require("potrace"),_require=require("../models/historymodel"),insertarRegistro=_require.insertarRegistro;function convertirImagen(r,t){var n,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.file){e.next=3;break}return e.abrupt("return",t.status(400).send("No se ha proporcionado ning√∫n archivo"));case 3:if(n="png",r.body.opciones&&("JPEG"===(a=r.body.opciones.toUpperCase())?n="jpeg":"JPG"===a?n="jpg":"SVG"!==a&&"PNG"!==a&&"WEBP"!==a||(n=a.toLowerCase())),"svg"===n)return e.next=8,regeneratorRuntime.awrap(sharp(r.file.buffer).toBuffer());e.next=14;break;case 8:return o=e.sent,e.next=11,regeneratorRuntime.awrap(new Promise(function(t,n){potrace.trace(o,{threshold:128},function(e,r){e?n(e):t(r)})}));case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,regeneratorRuntime.awrap(sharp(r.file.buffer).toFormat(n).toBuffer());case 16:o=e.sent;case 17:return e.next=19,regeneratorRuntime.awrap(insertarRegistro(r.file.originalname,"imagen_convertida.".concat(n),n));case 19:t.set({"Content-Type":"image/".concat(n),"Content-Disposition":'attachment; filename="imagen_convertida.'.concat(n,'"')}),t.send(o),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error al convertir la imagen:",e.t0),t.status(500).send("Error interno del servidor");case 27:case"end":return e.stop()}},null,null,[[0,23]])}module.exports={convertirImagen:convertirImagen};
//# sourceMappingURL=conversionController.min.js.map
