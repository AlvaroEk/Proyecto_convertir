"use strict";var jwt=require("jsonwebtoken"),bcrypt=require("bcrypt"),dotenv=require("dotenv"),path=require("path");function authenticate(r,n,e){var t,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.cookies.token){e.next=4;break}return console.log("no hay token"),e.abrupt("return",n.redirect("/login"));case 4:e.prev=4,o=jwt.verify(t,process.env.ACCESS_TOKEN_SECRET),r.userId=o.userId,console.log("token y decoded y userID\n",t,o,userId),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.log("hay un problema con el login xd"),e.abrupt("return",n.redirect("/login"));case 14:case"end":return e.stop()}},null,null,[[4,10]])}function generateToken(e){return jwt.sign({userId:e},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"1h"})}function getHash(r){var n,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=parseInt(process.env.PASSWORD_SALT_ROUNDS),e.next=3,regeneratorRuntime.awrap(bcrypt.hash(r,n));case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}})}function comparePassword(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("passwordString",r),console.log("bdHash",n),e.next=4,regeneratorRuntime.awrap(bcrypt.compare(r,n));case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}})}dotenv.config(),module.exports={authenticate:authenticate,generateToken:generateToken,getHash:getHash,comparePassword:comparePassword};
//# sourceMappingURL=authMiddleware.min.js.map
