"use strict";var express=require("express"),app=express(),path=require("path"),multer=require("multer"),router=require("./routes/routes"),conversionController=require("./controllers/conversionController"),session=require("express-session"),flash=require("connect-flash"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,SQLiteStore=require("connect-sqlite3")(session),db=require("./db"),dotenv=require("dotenv"),cookieParser=require("cookie-parser");app.use(cookieParser()),dotenv.config(),app.use(session({secret:process.env.ACCESS_TOKEN_SECRET,resave:!1,saveUninitialized:!1,store:new SQLiteStore({db:"sessionsDB.sqlite",table:"sessions"})})),app.use(flash()),app.use(passport.initialize()),app.use(passport.session()),passport.use(new LocalStrategy(function(e,r,o){db.obtenerUsuarioPorNombre(e,function(e,s){return e?o(e):s?s.password!==r?o(null,!1,{message:"Contraseña incorrecta."}):o(null,s):o(null,!1,{message:"Usuario incorrecto."})})})),passport.serializeUser(function(e,s){s(null,e.id)}),passport.deserializeUser(function(e,r){db.getUserById(e,function(e,s){r(e,s)})}),app.use(function(e,s,r){s.locals.carrito=e.session.carrito||[],console.log("Solicitud recibida: ".concat(e.method," ").concat(e.url)),r()}),app.use(function(e,s,r,o){console.error(e.stack),r.status(500).send("Algo salió mal")}),app.use(express.urlencoded({extended:!0})),app.set("view engine","pug"),app.set("views",path.join(__dirname,"views")),app.use(express.static("public")),app.use(express.json()),app.use("/",router),app.use(express.static("public"));var storage=multer.memoryStorage(),upload=multer({storage:storage});app.use(upload.single("seleccionarImg")),app.post("/convertir",conversionController.convertirImagen);var port=3e3;app.listen(port,function(){console.log("Servidor iniciado en http://localhost:".concat(port))});
//# sourceMappingURL=server.min.js.map
