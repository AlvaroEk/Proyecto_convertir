"use strict";var express=require("express"),app=express(),session=require("express-session"),path=require("path"),router=require("./routes/routes"),flash=require("connect-flash"),conversionController=require("./controllers/conversionController"),LocalStrategy=require("passport-local").Strategy,usuarios=require("./models/usermodel"),multer=require("multer"),dotenv=require("dotenv"),MySQLStore=require("express-mysql-session")(session),cookieParser=require("cookie-parser"),passport=require("passport"),authMiddleware=require("./middlewares/authMiddleware");app.use(express.static("public")),app.use(express.json()),app.use(express.urlencoded({extended:!0}));var sessionStore=new MySQLStore({host:process.env.MYSQL_HOST,port:process.env.MYSQL_PORT,user:process.env.MYSQL_USER,password:process.env.MYSQL_PASSWORD,database:process.env.MYSQL_DATABASE});app.use(cookieParser()),app.use(session({secret:process.env.ACCESS_TOKEN_SECRET,resave:!1,saveUninitialized:!1,store:sessionStore})),app.use(passport.initialize()),app.use(passport.session()),app.use(function(e,r,s,t){console.error(e.stack),s.status(500).send("Algo salió mal")}),passport.use(new LocalStrategy(function(r,s,t){var o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(usuarios.obtenerPorNombre(r));case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",t(null,!1,{message:"Usuario incorrecto."}));case 6:return e.next=8,regeneratorRuntime.awrap(authMiddleware.comparePassword(s,o.contraseña));case 8:if(e.sent){e.next=11;break}return e.abrupt("return",t(null,!1,{message:"Contraseña incorrecta."}));case 11:return e.abrupt("return",t(null,o));case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",t(e.t0));case 17:case"end":return e.stop()}},null,null,[[0,14]])})),passport.serializeUser(function(e,r){r(null,e.id)}),passport.deserializeUser(function(r,s){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(usuarios.obtenerPorId(r).then(function(e){s(null,e)}).catch(function(e){s(e,null)}));case 2:case"end":return e.stop()}})}),app.use("/",router),app.set("view engine","pug"),app.set("views",path.join(__dirname,"views"));var storage=multer.memoryStorage(),upload=multer({storage:storage});app.use(upload.single("seleccionarImg")),app.post("/convertir",conversionController.convertirImagen);var port=3e3;app.listen(port,function(){console.log("Servidor iniciado en http://localhost:".concat(port))});
//# sourceMappingURL=server.min.js.map
