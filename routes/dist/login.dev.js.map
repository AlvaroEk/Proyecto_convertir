{"version":3,"sources":["login.js"],"names":["express","require","router","Router","passport","authMiddleware","get","req","res","render","title","user","nombre","post","authenticate","failureRedirect","failureFlash","token","generateToken","id","cookie","httpOnly","secure","console","log","redirect","module","exports"],"mappings":";;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAf;;AACA,IAAMC,QAAQ,GAAGH,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAMI,cAAc,GAAGJ,OAAO,CAAC,+BAAD,CAA9B,C,CAAiE;AAEjE;;;AACAC,MAAM,CAACI,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5BA,EAAAA,GAAG,CAACC,MAAJ,CAAW,OAAX,EAAoB;AAAEC,IAAAA,KAAK,EAAE,gBAAT;AAA2BC,IAAAA,IAAI,EAAEJ,GAAG,CAACI,IAAJ,IAAY,IAAZ,aAAsBJ,GAAG,CAACI,IAAJ,CAASC,MAA/B,IAA0C;AAA3E,GAApB;AACD,CAFD;AAKAV,MAAM,CAACW,IAAP,CAAY,GAAZ,EAAiBT,QAAQ,CAACU,YAAT,CAAsB,OAAtB,EAA+B;AAC9CC,EAAAA,eAAe,EAAE,QAD6B;AAE9CC,EAAAA,YAAY,EAAE;AAFgC,CAA/B,CAAjB,EAGI,iBAAOT,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACF;AACMS,UAAAA,KAFJ,GAEYZ,cAAc,CAACa,aAAf,CAA6BX,GAAG,CAACI,IAAJ,CAASQ,EAAtC,CAFZ;AAKFX,UAAAA,GAAG,CAACY,MAAJ,CAAW,OAAX,EAAoBH,KAApB,EAA2B;AAAEI,YAAAA,QAAQ,EAAE,IAAZ;AAAkBC,YAAAA,MAAM,EAAE;AAA1B,WAA3B;AAEAC,UAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ,EAAyDP,KAAzD;AACAT,UAAAA,GAAG,CAACiB,QAAJ,CAAa,GAAb;;AARE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAHJ;AAeAC,MAAM,CAACC,OAAP,GAAiBzB,MAAjB","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst passport = require('passport');\r\nconst authMiddleware = require('../middlewares/authMiddleware'); // Middleware para proteger rutas\r\n\r\n// Ruta para mostrar el formulario de login\r\nrouter.get('/', (req, res) => {\r\n  res.render('login', { title: 'Iniciar sesión', user: req.user != null ? `${req.user.nombre}` : '' });\r\n});\r\n\r\n\r\nrouter.post('/', passport.authenticate('local', {\r\n  failureRedirect: '/login',\r\n  failureFlash: true\r\n}), async (req, res) => {\r\n  // Si se autentica correctamente, crea un token JWT\r\n  const token = authMiddleware.generateToken(req.user.id);\r\n\r\n  \r\n  res.cookie('token', token, { httpOnly: true, secure: false });\r\n\r\n  console.log(\"se autentifico correctamente el token jwt\", token)\r\n  res.redirect('/');\r\n});\r\n\r\n\r\nmodule.exports = router;"],"file":"login.dev.js"}