{"version":3,"sources":["login.js"],"names":["express","require","router","Router","authMiddleware","passport","res","render","title","user","req","concat","nombre","post","authenticate","token","generateToken","id","failureRedirect","httpOnly","secure","console","log","redirect","module","exports"],"mappings":"aAAA,IAAMA,QAAUC,QAAQ,WAClBC,OAASF,QAAQG,SADjBH,SAAUC,QAAQ,YAGlBG,eAAiBH,QAAQ,iCAD/BC,OAAMG,IAAAA,IAAWJ,SAAAA,EAAOK,GAKtBA,EAAIC,OAAO,QAAS,CAAEC,MAAO,iBAAkBC,KAAkB,MAAZC,EAAID,KAAJ,GAAAE,OAAsBD,EAAID,KAAKG,QAAW,OAIjGV,OAAOW,KAAK,IAAKR,SAASS,aAAa,QAAS,CALhDZ,gBAAgB,SACdI,cAAW,IAAWE,SAAOE,EAAAJ,GAAPE,IAAAA,EAAAA,OAAAA,mBAAAA,MAAAA,SAAAA,GAAAA,OAAAA,OAAAA,EAAAA,KAAAA,EAAAA,MAAAA,KAAAA,EAAtBO,EAAAX,eAAAY,cAAAN,EAAAD,KAAAQ,IAKAC,EAAAA,OAAAA,QAAiBH,EAD6B,CAAAI,UAAA,EAAAC,QAAA,IAAhDC,QAGIC,IAAA,4CAAAP,GAAAT,EAAAiB,SAAA,KAPoBf,KAAAA,EAAAA,IAAAA,MAAAA,OAAAA,EAAAA,YAOpBgB,OAAAC,QAAAvB","file":"login.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst passport = require('passport');\r\nconst authMiddleware = require('../middlewares/authMiddleware'); // Middleware para proteger rutas\r\n\r\n// Ruta para mostrar el formulario de login\r\nrouter.get('/', (req, res) => {\r\n  res.render('login', { title: 'Iniciar sesión', user: req.user != null ? `${req.user.nombre}` : '' });\r\n});\r\n\r\n\r\nrouter.post('/', passport.authenticate('local', {\r\n  failureRedirect: '/login',\r\n  failureFlash: true\r\n}), async (req, res) => {\r\n  // Si se autentica correctamente, crea un token JWT\r\n  const token = authMiddleware.generateToken(req.user.id);\r\n\r\n  \r\n  res.cookie('token', token, { httpOnly: true, secure: false });\r\n\r\n  console.log(\"se autentifico correctamente el token jwt\", token)\r\n  res.redirect('/');\r\n});\r\n\r\n\r\nmodule.exports = router;"]}